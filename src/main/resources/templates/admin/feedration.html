<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Расчет рациона</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
<div class="content container mt-5">
    <h1>Расчет рациона</h1>
    <table class="table table-striped mt-3">
        <thead>
        <tr>
            <th>Корм</th>
            <th>Килограммы корма</th>
            <th>Структура по ОЭ, %</th>
            <th>Корм. ед.</th>
            <th>Обмен.энерг., МДж</th>
            <th>Сухое в-во, г.</th>
            <th>Сырой протеин,г</th>
            <th>Перев.протеин, г</th>
            <th>сыр. жир, г</th>
            <th>сыр.клетчатка,г</th>
            <th>крахмал,г</th>
            <th>Сахар,г</th>
            <th>кальций,г</th>
            <th>Фосфор,г</th>
            <th>Магний,г</th>
            <th>Калий,г</th>
            <th>Сера,г</th>
            <th>Железо, мг</th>
            <th>Медь, мг</th>
            <th>Цинк, мг</th>
            <th>Марганец, мг</th>
            <th>Кобальт, мг</th>
            <th>Йод, мг</th>
            <th>Каротин, мг</th>
            <th>Вит. Д, МЕ</th>
            <th>Вит. Е, мг</th>
            <th>ЛФУ</th>
            <th>мин</th>
            <th>макс</th>
        </tr>
        </thead>
        <tbody id="feed-table-body">
        <tr>
            <td>
                <select class="form-select" style="width: 300px" onchange="addRow(this)">
                    <option value="">Выберите</option>
                    <option th:each="feed:${feeds}"
                            th:value="${feed.name}"
                            th:utext="${feed.name}"
                            th:data-feedUnit="${feed.nutrients.feedUnit}"
                            th:data-energyExchange="${feed.nutrients.energyExchange}"
                            th:data-dryMatter="${feed.nutrients.dryMatter}"
                            th:data-dryProtein="${feed.nutrients.dryProtein}"
                            th:data-digestedProtein="${feed.nutrients.digestedProtein}"
                            th:data-rawFat="${feed.nutrients.rawFat}"
                            th:data-rawFiber="${feed.nutrients.rawFiber}"
                            th:data-starch="${feed.nutrients.starch}"
                            th:data-sugar="${feed.nutrients.sugar}"
                            th:data-calcium="${feed.nutrients.calcium}"
                            th:data-phosphorus="${feed.nutrients.phosphorus}"
                            th:data-magnesium="${feed.nutrients.magnesium}"
                            th:data-potassium="${feed.nutrients.potassium}"
                            th:data-sulfur="${feed.nutrients.sulfur}"
                            th:data-ferrum="${feed.nutrients.ferrum}"
                            th:data-copper="${feed.nutrients.copper}"
                            th:data-zins="${feed.nutrients.zins}"
                            th:data-manganese="${feed.nutrients.manganese}"
                            th:data-cobalt="${feed.nutrients.cobalt}"
                            th:data-iodine="${feed.nutrients.iodine}"
                            th:data-carotene="${feed.nutrients.carotene}"
                            th:data-vitaminE="${feed.nutrients.vitaminE}"
                            th:data-vitaminD="${feed.nutrients.vitaminD}">
                    </option>
                </select>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<script>
    function addRow(selectElement) {
        if (selectElement.value) {
            const selectedOption = selectElement.selectedOptions[0];
            const nutrients = [
                'feedUnit', 'energyExchange', 'dryMatter', 'dryProtein', 'digestedProtein', 'rawFat', 'rawFiber',
                'starch', 'sugar', 'calcium', 'phosphorus', 'magnesium', 'potassium', 'sulfur', 'ferrum', 'copper',
                'zins', 'manganese', 'cobalt', 'iodine', 'carotene', 'vitaminE', 'vitaminD'
            ];

            const rowData = [
                selectElement.value,
                '<input type="number" class="form-control" value="1" oninput="updateRow(this)">',
                ''
            ];

            nutrients.forEach(nutrient => {
                rowData.push(selectedOption.getAttribute(`data-${nutrient}`));
            });

            const tableBody = document.getElementById('feed-table-body');
            const newRow = document.createElement('tr');

            rowData.forEach(data => {
                const newCell = document.createElement('td');
                if (typeof data === 'string' && data.includes('<input')) {
                    newCell.innerHTML = data;
                } else {
                    newCell.textContent = data;
                    newCell.setAttribute('data-original-value', data);
                }
                newRow.appendChild(newCell);
            });

            tableBody.insertBefore(newRow, selectElement.parentElement.parentElement);

            selectElement.value = '';
        }
    }

    function updateRow(inputElement) {
        const quantity = parseFloat(inputElement.value);
        const row = inputElement.parentElement.parentElement;
        const cells = row.children;

        for (let i = 3; i < cells.length; i++) {
            const cell = cells[i];
            const originalValue = parseFloat(cell.getAttribute('data-original-value'));
            if (!isNaN(originalValue)) {
                cell.textContent = (originalValue * quantity).toFixed(2);
            }
        }
    }
</script>
</body>
</html>
